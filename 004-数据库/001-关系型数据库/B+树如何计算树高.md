## B+树如何计算树高

**小伙伴们是否还记得，MySQL的B+树的高度怎么计算的呢？** 顺便复习一下吧

InnoDB存储引擎最小储存单元是页，一页大小就是16k。B+树叶子存的是数据，内部节点存的是键值+指针。索引组织表通过非叶子节点的二分查找法以及指针确定数据在哪个页中，进而再去数据页中找到需要的数据，B+树结构图如下：

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/fEsWkVrSk54UldUQYBr5q3zTSy5pRjJzcibBG0nyORnhJeleDVgFHcicS37xYj9fjQmWCnHjdCgSckUU7icuiadZ9g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

假设B+树的高度为2的话，即有一个根结点和若干个叶子结点。这棵B+树的存放总记录数为=根结点指针数*单个叶子节点记录行数。

- 如果一行记录的数据大小为1k，那么单个叶子节点可以存的记录数  `=16k/1k =16`.
- 非叶子节点内存放多少指针呢？我们假设主键ID为**bigint类型，长度为8字节**(**面试官问你int类型，一个int就是32位，4字节**)，而指针大小在InnoDB源码中设置为6字节，所以就是 `8+6=14 `字节，`16k/14B =16*1024B/14B = 1170`



因此，一棵高度为2的B+树，能存放`1170 * 16=18720`条这样的数据记录。

同理一棵高度为`3`的B+树，能存放`1170 *1170 *16 =21902400`，大概可以存放两千万左右的记录。B+树高度一般为1-3层，如果B+到了4层，查询的时候会**多查磁盘**的次数，SQL就会变慢。

因此单表数据量超过千万，就需要考虑分表啦。