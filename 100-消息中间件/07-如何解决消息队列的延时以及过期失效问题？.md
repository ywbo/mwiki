
> ## 6、如何解决消息队列的延时以及过期失效问题？ 

【场景假设】现在消费端出故障了，然后大量消息在 MQ 中堆积，现在出事故了，慌得一批。

假如你使用的是 `RabbitMQ`，`RabbitMQ` 是可以**设置过期时间**的，也就是 `TTL`。如果消息在 `Queue` 中积压超过一定时间就会被 `RabbitMQ` 给清理掉了，这个数据就没了。那这就是第二个大坑了。这就不是 **大量数据积压在 MQ 中** 的问题了，而是 **大量数据会直接搞丢的问题！**

这个情况下，就不要说增加 `consumer` 消费积压的消息，因为事假上没有啥积压，而是把大量消息数据搞丢了。我们可以采取一个方案，就是 **批量重导**。这个我们之前之前线上遇到这个场景。就是大量积压的时候，我们当时直接丢弃数据了，只能等到高峰值过去，选一个用户不使用的时间（晚上 12 点），我们写临时程序，将丢失的数据一点点查出来，然后重新导入到 MQ 中去，白天丢失的数据，就给找补回来了。也只能这样。

假设 1 万个订单，积压在 MQ 中，没有处理，其中 1000 个订单数据丢了，你只能手写把那 1000 条数据查出来，手动发动到 MQ 中，在补消费一次。
